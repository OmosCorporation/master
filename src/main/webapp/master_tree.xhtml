<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <title><h:outputText value="#{TreeNotePage.pageTabName}" /></title>
        <h:outputStylesheet library="css" name="custom_tree.css"/>
        <h:outputStylesheet library="css" name="omos_basic.css"/>
    </h:head>
    <h:body>
            <h:form id="tree_form">
                <!--addNode-->
                <p:commandButton class="function_head_btn" value="AddNode" actionListener="#{TreeNotePage.addRote()}"  update="tree_form:treeBodyArea" style=" text-align: left!important;"/>
                <!--Node Expand Button-->
                <p:commandButton  id="expandBtn" class="function_head_btn"
                               value="#{TreeNotePage.getExpandModeName()}" 
                               actionListener="#{TreeNotePage.changeExpandlMode()}" 
                               update="tree_form:treeBodyArea tree_form:expandBtn"/>
                <!--Node delete Button Off-->
                <p:commandButton  id="delModeBtn" class="function_head_btn"
                                    value="#{TreeNotePage.getNameDelMode()}" 
                                    actionListener="#{TreeNotePage.changeDelMode()}" 
                                    update="tree_form:treeBodyArea tree_form:delModeBtn"/>
                <p:tree id="treeBodyArea" 
                                class="ui-tree-custom" 
                                value="#{TreeNotePage.root}"  
                                cache="false"
                                var="note" 
                                datakey="#{note.noteRid}"
                                dynamic="true" 
                                animate="true"
                                styleClass="tree-table-class"
                                >
                    <p:ajax event="expand" listener="#{TreeNotePage.expandTreeNode(note)}" />
                    <p:ajax event="collapse" listener="#{TreeNotePage.collapseTreeNode(note)}" />

                    <p:treeNode id="treenode" styleClass="custom-tree-node" >
                        <label for='treenode'>
                        <!--Text Area-->
                            <p:inputText id="noteTextArea_#{note.noteRid}" class="noteTextAreaClass" value="#{note.noteTitle}" size="40" maxlength="1000" >
                                <p:ajax event="click" listener="#{TreeNotePage.setEditTarget(note)}" update="tree_TextFrom"/>
                                <p:ajax event="change" listener="#{TreeNotePage.updateNode(note)}"/>
                            </p:inputText>
                           
                        <script>
                            // noteTextAreaのIDを取得して、tooltipのfor属性に設定する
                            var noteTextAreaId = "noteTextArea_#{note.noteRid}";
                            $(document).ready(function() {
                                $('[id="' + noteTextAreaId + '"]').each(function() {
                                    var tooltipFor = $(this).attr('id');
                                    $(this).find('.ui-tooltip').attr('for', tooltipFor);
                                });
                            });
                        </script>
                            <!--Tree add Button-->
                            <h:outputLabel rendered="#{TreeNotePage.delMode ne true}">
                                <p:commandButton id="nodeFunctionBtn" value="+" 
                                                 class="btn call_blue"
                                                 update="tree_form"
                                                 actionListener="#{TreeNotePage.addNode(note)}" 
                                                 oncomplete="focusNewNode('#{note.noteRid}')"
                                                 >
                                </p:commandButton>
                                <script>
                                    function focusNewNode(noteRid) {
                                        // 新しいノードの ID を組み立てる
                                        var newNoteId = 'tree_form:treeBodyArea:' + noteRid;

                                        // 新しいノードの要素を取得
                                        var newNode = $('#' + newNoteId + ' .noteTextAreaClass');

                                        // フォーカスを設定
                                        newNode.focus();
                                    }
                                </script>
                            </h:outputLabel>
                            <!--Tree delete Button-->
                            <h:outputLabel rendered="#{TreeNotePage.delMode eq true}">
                                <p:commandButton id="del_btn" value="-" 
                                                 actionListener="#{TreeNotePage.deleteNode(note)}" 
                                                 update="tree_form"
                                                 rendered="#{TreeNotePage.delMode}" 
                                                 class="btn call_red"
                                                 style="font-size: smaller;"/>
                            </h:outputLabel>
                        </label>
                        <p:tooltip for="treenode"  position="top" value="test tooltip">
                        </p:tooltip>
                    </p:treeNode>
                </p:tree>
            </h:form>
            <!--editArea-->
            <h:form id="tree_TextFrom" class="tree_TextFormClass">
                <div class="edit_area_title">
                    <h:outputText class="edit_area_title_text" value="#{TreeNotePage.editTargetNote.noteTitle}"/>
                </div>
                <p:inputTextarea id="noteTextEditArea" class="targetClass_TextEditArea" cols="50" rows="30" maxlength="100000" value="#{TreeNotePage.editTargetNote.noteText}">
                    <p:ajax event="change" listener="#{TreeNotePage.updateEditTarget()}"/>
                </p:inputTextarea>
            </h:form>
    </h:body>
</html>
